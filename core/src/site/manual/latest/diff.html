<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
        <title>LiquiBase: Database Diff</title>
        <style type='text/css' media='screen'>@import "../../include/css/main.css";</style>
    </head>
    <body>@ANALYTICS@
        @SITE_NAME@

        <div id="container">
                @NAV.MANUAL@


            <div id="content">
                <div class="entry">
                    <h2>Database "Diff"</h2>
                    <p>
                        While the best way to track database changes is by adding change sets during development (see <a
                        href="http://blog.liquibase.org/2007/06/problem-with-database-diffs.html">the problem with database diffs</a>), there are times when being able to perform database diffs is valuable, particularly near the end of a project as a double-check that all required changes are included in the change log.

                    </p>
                    <h2>Running Diff</h2>
                    <p>
                        Diff command support is available through the <a href="command_line_migrator.html">command line migrator</a> only.  When diff-ing databases, you specify the target database like you normally do in LiquiBase (--url, --username, etc. flags) and you specify the base database with additional flags after the command name.
                    </p>
                    <h3>Example</h3>
                    <pre>
liqubase.sh --driver=oracle.jdbc.OracleDriver \
        --url=jdbc:oracle:thin:@testdb:1521:test \
        --username=bob \
        --password=bob \
    diff \
        --baseUrl=jdbc:oracle:thin:@localhost/XE \
        --baseUsername=bob \
        --basePassword=bob</pre>
                    <h2>Database Comparisons</h2>
                    <p>
                        Currently, LiquiBase runs the following comparisons:
                    </p>
                    <ul>
                        <li>Version Differences</li>
                        <li>Missing/unexpected tables</li>
                        <li>Missing/unexpected views</li>
                        <li>Missing/unexpected columns</li>
                        <li>Missing/unexpected primary keys</li>
                        <li>Missing/unexpected foreign Keys</li>
                        <li>Missing/unexpected sequences</li>
                        <li>Missing/unexpected indexes</li>
                        <li>Column definition differences (data type, auto-increment, etc.)</li>
                        <li>View definition differences</li>
                    </ul>
                    <p>
                        It does not (currently) check
                    </p>
                    <ul>
                        <li>Non-foreign key constraints (unique, etc)</li>
                        <li>Stored Procedures</li>
                        <li>Data differences</li>
                    </ul>
                    <p>
                        LiquiBase can diff different database types, but the results may be skewed due to differences in case and data types. 
                    </p>

                    <h2>Output Modes</h2>
                    <p>
                        LiquiBase supports two output modes:  report mode ("diff") and change log mode ("diffChangeLog").  In both modes, diff progress is reported to standard error during execution.
                    </p>

                    <h3>Report Mode</h3>
                    <p>
                        In report mode, a description of the differences between two databases is reported to standard out.
                    </p>
<pre>
Base Database: BOB jdbc:oracle:thin:@testdb:1521:latest
Target Database: BOB jdbc:oracle:thin:@localhost/XE
Product Name: EQUAL
Product Version:
     Base:   'Oracle Database 10g Enterprise Edition Release 10.2.0.1.0
With the Partitioning, OLAP and Data Mining options'
     Target: 'Oracle Database 10g Express Edition Release 10.2.0.1.0'
Missing Tables: NONE
Unexpected Tables: NONE
Missing Views: NONE
Unexpected Views: NONE
Missing Columns:
     CREDIT.MONTH
     CREDIT.COMPANY
     CMS_TEMPLATE.CLASSTYPE
     CONTENTITEM.SORTORDER
Unexpected Columns:
     CATEGORY.SORTORDER
Missing Foreign Keys: NONE
Unexpected Foreign Keys:
     FK_NAME (ID_VC -> STATUS_ID_VC)
Missing Primary Keys: NONE
Unexpected Primary Keys: NONE
Missing Indexes: NONE
Unexpected Indexes: NONE
Missing Sequences: NONE
Unexpected Sequences: NONE
</pre>

                    <h3>ChangeLog Mode</h3>
                    <p>
                    In change log mode, the an XML change log of what is necessary to upgrade the base database to the target database is sent to standard out.  This change log can be included as is, or copied into an existing change log.
                    </p>
                    <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.1"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.1
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.1.xsd"&gt;
    &lt;changeSet author="diff-generated" id="1185206820975-1"&gt;
        &lt;addColumn tableName="CREDIT"&gt;
            &lt;column name="MONTH" type="VARCHAR2(10)"/&gt;
        &lt;/addColumn&gt;
    &lt;/changeSet&gt;
    &lt;changeSet author="diff-generated" id="1185206820975-2"&gt;
        &lt;addColumn tableName="CREDIT"&gt;
            &lt;column name="COMPANY" type="NUMBER(22,0)"/&gt;
        &lt;/addColumn&gt;
    &lt;/changeSet&gt;
    &lt;changeSet author="diff-generated" id="1185206820975-3"&gt;
        &lt;addColumn tableName="CMS_TEMPLATE"&gt;
            &lt;column name="CLASSTYPE" type="VARCHAR2(255)"/&gt;
        &lt;/addColumn&gt;
    &lt;/changeSet&gt;
    &lt;changeSet author="diff-generated" id="1185206820975-4"&gt;
        &lt;addColumn tableName="CONTENTITEM"&gt;
            &lt;column name="SORTORDER" type="NUMBER(22)"/&gt;
        &lt;/addColumn&gt;
    &lt;/changeSet&gt;
    &lt;changeSet author="diff-generated" id="1185206820975-5"&gt;
        &lt;dropColumn columnName="SORTORDER" tableName="CATEGORY"/&gt;
    &lt;/changeSet&gt;
    &lt;changeSet author="diff-generated" id="1185206820975-6"&gt;
        &lt;dropForeignKeyConstraint baseTableName="CMS_STATUS"
                     constraintName="FK_NAME"/&gt;
    &lt;/changeSet&gt;
&lt;/databaseChangeLog&gt;</pre>
                </div>
            </div>
        </div>

    </body>
</html>